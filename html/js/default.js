var Tickets={initialize:function(){"function"!=typeof window.prettyPrint&&($.getScript(TicketsConfig.jsUrl+"lib/prettify/prettify.js",function(){prettyPrint()}),$("<link/>",{rel:"stylesheet",type:"text/css",href:TicketsConfig.jsUrl+"lib/prettify/prettify.css"}).appendTo("head")),jQuery().ajaxForm||document.write('<script src="'+TicketsConfig.jsUrl+'lib/jquery.form.min.js"></script>'),jQuery().jGrowl||document.write('<script src="'+TicketsConfig.jsUrl+'lib/jquery.jgrowl.min.js"></script>'),jQuery().sisyphus||document.write('<script src="'+TicketsConfig.jsUrl+'lib/jquery.sisyphus.min.js"></script>'),$(document).on("click","#comment-preview-placeholder a",function(){return!1}),$(document).on("change","#comments-subscribe",function(){Tickets.comment.subscribe($('[name="thread"]',$("#comment-form")))}),$(document).on("change","#tickets-subscribe",function(){Tickets.ticket.subscribe($(this).data("id"))}),$(document).on("submit","#ticketForm",function(t){return Tickets.ticket.save(this,$(this).find('[type="submit"]')[0]),t.preventDefault(),!1}),$(document).on("submit","#comment-form",function(t){return Tickets.comment.save(this,$(this).find('[type="submit"]')[0]),t.preventDefault(),!1}),$(document).on("click touchend","#ticketForm .preview, #ticketForm .save, #ticketForm .draft, #ticketForm .publish",function(t){return $(this).hasClass("preview")?Tickets.ticket.preview(this.form,this):Tickets.ticket.save(this.form,this),t.preventDefault(),!1}),$(document).on("click touchend","#comment-form .preview, #comment-form .submit",function(t){return $(this).hasClass("preview")?Tickets.comment.preview(this.form,this):Tickets.comment.save(this.form,this),t.preventDefault(),!1}),$(document).on("keydown","#ticketForm, #comment-form",function(t){13==t.keyCode&&(t.shiftKey&&(t.ctrlKey||t.metaKey)?$(this).submit():(t.ctrlKey||t.metaKey)&&$(this).find('input[type="button"].preview').click())}),$(document).on("click touchend","#comment-new-link a",function(t){return Tickets.forms.comment(),t.preventDefault(),!1}),$(document).on("click touchend",".comment-reply a",function(t){var e=$(this).parents(".ticket-comment").data("id");return $(this).hasClass("reply")?Tickets.forms.reply(e):$(this).hasClass("edit")&&Tickets.forms.edit(e),t.preventDefault(),!1}),$(document).on("click touchend",".ticket-comment-rating.active > .vote",function(t){var e=$(this).parents(".ticket-comment").data("id");return $(this).hasClass("plus")?Tickets.Vote.comment.vote(this,e,1):$(this).hasClass("minus")&&Tickets.Vote.comment.vote(this,e,-1),t.preventDefault(),!1}),$(document).on("click touchend",".ticket-rating.active > .vote",function(t){var e=$(this).parents(".ticket-meta").data("id");return $(this).hasClass("plus")?Tickets.Vote.ticket.vote(this,e,1):$(this).hasClass("minus")?Tickets.Vote.ticket.vote(this,e,-1):Tickets.Vote.ticket.vote(this,e,0),t.preventDefault(),!1}),$(document).on("click touchend",".ticket-comment-star.active > .star",function(t){var e=$(this).parents(".ticket-comment").data("id");return Tickets.Star.comment.star(this,e,0),t.preventDefault(),!1}),$(document).on("click touchend",".ticket-star.active > .star",function(t){var e=$(this).parents(".ticket-meta").data("id");return Tickets.Star.ticket.star(this,e,0),t.preventDefault(),!1}),$(document).ready(function(){1==TicketsConfig.enable_editor&&$("#ticket-editor").markItUp(TicketsConfig.editor.ticket),1==TicketsConfig.enable_editor&&$("#comment-editor").markItUp(TicketsConfig.editor.comment),$.jGrowl.defaults.closerTemplate="<div>[ "+TicketsConfig.close_all_message+" ]</div>";var t=$(".ticket-comment").length;$("#comment-total, .ticket-comments-count").text(t),$("#ticketForm.create").sisyphus({excludeFields:$("#ticketForm .disable-sisyphus")}),$("#comment-form").is(":visible")&&$("#comment-new-link").hide()}),$("#comments").on("click touchend",".ticket-comment-up a",function(){var t=$(this).data("id"),e=$(this).data("parent");return e&&t&&(Tickets.utils["goto"]("comment-"+e),$("#comment-"+e+" .ticket-comment-down:lt(1)").show().find("a").attr("data-child",t)),!1}),$("#comments").on("click touchend",".ticket-comment-down a",function(){var t=$(this).data("child");return t&&Tickets.utils["goto"]("comment-"+t),$(this).attr("data-child","").parent().hide(),!1})},ticket:{preview:function(t,e){$(t).ajaxSubmit({data:{action:"ticket/preview"},url:TicketsConfig.actionUrl,form:t,button:e,dataType:"json",beforeSubmit:function(){return $(e).attr("disabled","disabled"),!0},success:function(t){var i=$("#ticket-preview-placeholder");t.success?(i.html(t.data.preview).show(),prettyPrint()):(i.html("").hide(),Tickets.Message.error(t.message)),$(e).removeAttr("disabled")}})},save:function(t,e){var i="ticket/";switch($(e).prop("name")){case"draft":i+="draft";break;case"save":i+="save";break;default:i+="publish"}$(t).ajaxSubmit({data:{action:i},url:TicketsConfig.actionUrl,form:t,button:e,dataType:"json",beforeSubmit:function(){return $(t).find('input[type="submit"], input[type="button"]').attr("disabled","disabled"),$(".error",t).text(""),!0},success:function(e){if($("#ticketForm.create").sisyphus().manuallyReleaseData(),e.success)e.message&&Tickets.Message.success(e.message),"ticket/save"==i?$(t).find('input[type="submit"], input[type="button"]').removeAttr("disabled"):e.data.redirect&&(document.location.href=e.data.redirect);else if($(t).find('input[type="submit"], input[type="button"]').removeAttr("disabled"),Tickets.Message.error(e.message),e.data){var s,n;for(s in e.data)n=e.data[s],$(t).find('[name="'+n.field+'"]').parent().find(".error").text(n.message)}}})},subscribe:function(t){t&&$.post(TicketsConfig.actionUrl,{action:"section/subscribe",section:t},function(t){t.success?Tickets.Message.success(t.message):Tickets.Message.error(t.message)},"json")}},comment:{preview:function(t,e){return $(t).ajaxSubmit({data:{action:"comment/preview"},url:TicketsConfig.actionUrl,form:t,button:e,dataType:"json",beforeSubmit:function(){return $(e).attr("disabled","disabled"),!0},success:function(t){$(e).removeAttr("disabled"),t.success?($("#comment-preview-placeholder").html(t.data.preview).show(),prettyPrint()):Tickets.Message.error(t.message)}}),!1},save:function(t,e){return $(t).ajaxSubmit({data:{action:"comment/save"},url:TicketsConfig.actionUrl,form:t,button:e,dataType:"json",beforeSubmit:function(){return clearInterval(window.timer),$(".error",t).text(""),$(e).attr("disabled","disabled"),!0},success:function(i){if($(e).removeAttr("disabled"),i.success)Tickets.forms.comment(!1),$("#comment-preview-placeholder").html("").hide(),$("#comment-editor",t).val(""),$(".ticket-comment .comment-reply a").show(),!i.data.length&&i.message?Tickets.Message.info(i.message):(Tickets.comment.insert(i.data.comment),Tickets.utils["goto"]($(i.data.comment).attr("id"))),Tickets.comment.getlist(),prettyPrint();else if(Tickets.Message.error(i.message),i.data){var s,n,a=[];for(s in i.data){n=i.data[s];var o=$(t).find('[name="'+n.field+'"]').parent().find(".error");o.length>0?o.text(n.message):n.field&&n.message&&a.push(n.field+": "+n.message)}a.length>0&&Tickets.Message.error(a.join("<br/>"))}i.data.captcha&&($('input[name="captcha"]',t).val("").focus(),$("#comment-captcha",t).text(i.data.captcha))}}),!1},getlist:function(){var t=$("#comment-form"),e=$('[name="thread"]',t);return!!e&&(Tickets.tpanel.start(),$.post(TicketsConfig.actionUrl,{action:"comment/getlist",thread:e.val()},function(t){for(var e in t.data.comments)t.data.comments.hasOwnProperty(e)&&Tickets.comment.insert(t.data.comments[e],!0);var i=$(".ticket-comment").length;$("#comment-total, .ticket-comments-count").text(i),Tickets.tpanel.stop()},"json"),!0)},insert:function(t,e){var i=$(t),s=$(i).attr("data-parent"),n=$(i).attr("id"),a=$("#"+n),o="";if(a.length>0){var c=a.data("newparent");if(i.attr("data-newparent",c),t=i[0].outerHTML,!e)return void a.replaceWith(t);o=a.find(".comments-list").html(),a.remove()}if(0==s&&TicketsConfig.formBefore)$("#comments").prepend(t);else if(0==s)$("#comments").append(t);else{var r=$("#comment-"+s);if(r.data("parent")!=r.data("newparent"))s=r.data("newparent"),i.attr("data-newparent",s),t=i[0].outerHTML;else if(TicketsConfig.thread_depth){var m=r.parents(".ticket-comment").length;m>0&&m>=TicketsConfig.thread_depth-1&&(s=r.data("parent"),i.attr("data-newparent",s),t=i[0].outerHTML)}$("#comment-"+s+" > .comments-list").append(t)}o.length>0&&$("#"+n).find(".comments-list").html(o)},subscribe:function(t){t.length&&$.post(TicketsConfig.actionUrl,{action:"comment/subscribe",thread:t.val()},function(t){t.success?Tickets.Message.success(t.message):Tickets.Message.error(t.message)},"json")}},forms:{reply:function(t){$("#comment-new-link").show(),clearInterval(window.timer);var e=$("#comment-form");$(".time",e).text(""),$(".ticket-comment .comment-reply a").show(),$("#comment-preview-placeholder").hide(),$('input[name="parent"]',e).val(t),$('input[name="id"]',e).val(0);var i=$("#comment-"+t+" > .comment-reply");return e.insertAfter(i).show(),$("a",i).hide(),i.parents(".ticket-comment").removeClass("ticket-comment-new"),$("#comment-editor",e).val("").focus(),!1},comment:function(t){t!==!1&&(t=!0),clearInterval(window.timer),$("#comment-new-link").hide();var e=$("#comment-form");return $(".time",e).text(""),$(".ticket-comment .comment-reply a:hidden").show(),$("#comment-preview-placeholder").hide(),$('input[name="parent"]',e).val(0),$('input[name="id"]',e).val(0),$(e).insertAfter("#comment-form-placeholder").show(),$("#comment-editor",e).val(""),t&&$("#comment-editor",e).focus(),!1},edit:function(t){$("#comment-new-link").show();var e=$('#comment-form [name="thread"]').val();return $.post(TicketsConfig.actionUrl,{action:"comment/get",id:t,thread:e},function(e){if(e.success){clearInterval(window.timer),$(".ticket-comment .comment-reply a:hidden").show();var i=$("#comment-form");$("#comment-preview-placeholder").hide(),$('input[name="parent"]',i).val(0),$('input[name="id"]',i).val(t);var s=$("#comment-"+t+" > .comment-reply"),n=$(".time",i);n.text(""),i.insertAfter(s).show(),$("a",s).hide(),$("#comment-editor",i).val(e.data.raw).focus(),e.data.name&&$('[name="name"]',i).val(e.data.name),e.data.email&&$('[name="email"]',i).val(e.data.email);var a=e.data.time;window.timer=setInterval(function(){a>0?(a-=1,n.text(Tickets.utils.timer(a))):(clearInterval(window.timer),n.text(""))},1e3)}else Tickets.Message.error(e.message)},"json"),!1}},utils:{timer:function(t){days=Math.floor(t/86400),hours=Math.floor(t/3600),mins=Math.floor(t/60),secs=Math.floor(t),dd=days,hh=hours-24*days,mm=mins-60*hours,ss=secs-60*mins;var e=[];return hh>0&&e.push(hh?this.addzero(hh):"00"),e.push(mm?this.addzero(mm):"00"),e.push(ss?this.addzero(ss):"00"),e.join(":")},addzero:function(t){return t<10?"0"+t:t},"goto":function(t){$("html, body").animate({scrollTop:$("#"+t).offset().top},1e3)}}};Tickets.Message={success:function(t){t&&$.jGrowl(t,{theme:"tickets-message-success"})},error:function(t){t&&$.jGrowl(t,{theme:"tickets-message-error"})},info:function(t){t&&$.jGrowl(t,{theme:"tickets-message-info"})},close:function(){$.jGrowl("close")}},Tickets.Vote={comment:{options:{active:"active",inactive:"inactive",voted:"voted",vote:"vote",rating:"rating",positive:"positive",negative:"negative"},vote:function(t,e,i){t=$(t);var s=t.parent(),n=this.options,a=s.find("."+n.rating);return!s.hasClass(n.inactive)&&($.post(TicketsConfig.actionUrl,{action:"comment/vote",id:e,value:i},function(e){e.success?(t.addClass(n.voted),s.removeClass(n.active).addClass(n.inactive),s.find("."+n.vote),a.text(e.data.rating).attr("title",e.data.title),a.removeClass(n.positive+" "+n.negative),1==e.data.status?a.addClass(n.positive):e.data.status==-1&&a.addClass(n.negative)):Tickets.Message.error(e.message)},"json"),!0)}},ticket:{options:{active:"active",inactive:"inactive",voted:"voted",vote:"vote",rating:"rating",positive:"positive",negative:"negative"},vote:function(t,e,i){t=$(t);var s=t.parent(),n=this.options,a=s.find("."+n.rating);return!s.hasClass(n.inactive)&&($.post(TicketsConfig.actionUrl,{action:"ticket/vote",id:e,value:i},function(e){e.success?(t.addClass(n.voted),s.removeClass(n.active).addClass(n.inactive),s.find("."+n.vote),a.text(e.data.rating).attr("title",e.data.title).removeClass(n.vote),a.removeClass(n.positive+" "+n.negative),1==e.data.status?a.addClass(n.positive):e.data.status==-1&&a.addClass(n.negative)):Tickets.Message.error(e.message)},"json"),!0)}}},Tickets.Star={comment:{options:{stared:"stared",unstared:"unstared"},star:function(t,e,i){t=$(t);var s=this.options;t.parent();return $.post(TicketsConfig.actionUrl,{action:"comment/star",id:e},function(e){e.success?t.toggleClass(s.stared).toggleClass(s.unstared):Tickets.Message.error(e.message)},"json"),!0}},ticket:{options:{stared:"stared",unstared:"unstared",count:"ticket-star-count"},star:function(t,e,i){t=$(t);var s=this.options,n=t.parent().find("."+this.options.count);return $.post(TicketsConfig.actionUrl,{action:"ticket/star",id:e},function(e){e.success?(t.toggleClass(s.stared).toggleClass(s.unstared),n.text(e.data.stars)):Tickets.Message.error(e.message)},"json"),!0}}},Tickets.tpanel={wrapper:$("#comments-tpanel"),refresh:$("#tpanel-refresh"),new_comments:$("#tpanel-new"),class_new:"ticket-comment-new",initialize:function(){TicketsConfig.tpanel&&(this.wrapper.show(),this.stop()),this.refresh.on("click",function(){$("."+Tickets.tpanel.class_new).removeClass(Tickets.tpanel.class_new),Tickets.comment.getlist()}),this.new_comments.on("click",function(){var t=$("."+Tickets.tpanel.class_new+":first");$("html, body").animate({scrollTop:t.offset().top},1e3,"linear",function(){t.removeClass(Tickets.tpanel.class_new)});var e=parseInt(Tickets.tpanel.new_comments.text());e>1?Tickets.tpanel.new_comments.text(e-1):Tickets.tpanel.new_comments.text("").hide()})},start:function(){this.refresh.addClass("loading")},stop:function(){var t=$("."+this.class_new).length;t>0?this.new_comments.text(t).show():this.new_comments.hide(),this.refresh.removeClass("loading")}},"undefined"!=typeof TicketsConfig&&(Tickets.initialize(),Tickets.tpanel.initialize());
//# sourceMappingURL=maps/default.js.map
